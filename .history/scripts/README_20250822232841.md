# Payment Fix Scripts

These scripts help diagnose and fix payment issues where money is stuck in the platform and not transferred to celebrities.

## Quick Fix for Sarah's Payment

### 1. Check Sarah's Current Status
```bash
npm run check-sarah
```

This will show you:
- Sarah's Stripe Connect account status
- How many orders are pending transfer
- How much money is stuck in the platform
- Current transfer statuses

### 2. Fix Sarah's Stuck Payments
```bash
npm run fix-sarah-payment
```

This will:
- Find all completed orders for Sarah that haven't been transferred
- Create Stripe transfers for each pending order
- Update database records to track the transfers
- Move money from platform to Sarah's Stripe account

## What These Scripts Do

### `check-sarah-status.js`
- Diagnoses the current payment situation
- Shows exactly where money is stuck
- Identifies any Stripe account issues

### `manual-transfer-sarah.js`
- Creates Stripe transfers for pending payments
- Calculates proper platform fees (20%)
- Updates all database records
- Ensures money flows to Sarah's account

## When to Use

Use these scripts when:
- ✅ Customer payment succeeded
- ✅ Order is marked as COMPLETED
- ❌ Money is still in platform account
- ❌ Celebrity hasn't received payment

## After Running

1. **Check Sarah's Stripe Dashboard** - She should see incoming transfers
2. **Monitor Webhooks** - Transfers will be marked as PAID when complete
3. **Verify Database** - All records should be updated correctly

## Troubleshooting

If the scripts fail:
1. Check that Sarah has completed Stripe Connect onboarding
2. Verify her `stripeConnectAccountId` is set in the database
3. Ensure her Stripe account is active and payouts are enabled
4. Check your Stripe dashboard for any error messages

## Future Prevention

The fixed `process-approval-payment` route will prevent this issue for new orders. These scripts are only needed for orders that were processed before the fix.
